
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SimpleBalance â€“ Increase / Decrease</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 40px;
    }
    input {
      padding: 8px;
      margin: 5px;
      width: 220px;
    }
    button {
      padding: 8px 16px;
      margin: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>ðŸ’° SimpleBalance DApp</h2>
  <p>Increase / Decrease using your SimpleBalance contract</p>

  <!-- Connect -->
  <button id="connectBtn" onclick="connectWallet()">ðŸ”— Connect MetaMask</button>
  <p id="wallet">Not connected</p>

  <!-- Wallet Sepolia ETH balance -->
  <h3>Sepolia ETH Balance (Wallet)</h3>
  <p id="ethBalance">-</p>

  <hr />

  <!-- Single amount for both increase/decrease -->
  <h3>Amount (in ETH)</h3>
  <input id="amountInput" type="number" step="0.0001" placeholder="Enter amount in ETH" />

  <div>
    <button onclick="increase()">Increase (deposit)</button>
    <button onclick="decrease()">Decrease (withdraw)</button>
  </div>

  <script>
    // ------- CONTRACT DETAILS (SimpleBalance) -------
    const contractAddress = "0x8D383091126C1C60e474F324EddFb67bF248c990";

    const contractABI = [
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "user",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
          }
        ],
        "name": "Deposited",
        "type": "event"
      },
      {
        "anonymous": false,
        "inputs": [
          {
            "indexed": true,
            "internalType": "address",
            "name": "user",
            "type": "address"
          },
          {
            "indexed": false,
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
          }
        ],
        "name": "Withdrawn",
        "type": "event"
      },
      {
        "inputs": [
          {
            "internalType": "address",
            "name": "user",
            "type": "address"
          }
        ],
        "name": "balanceOf",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "contractBalance",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "deposit",
        "outputs": [],
        "stateMutability": "payable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "myBalance",
        "outputs": [
          {
            "internalType": "uint256",
            "name": "",
            "type": "uint256"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      },
      {
        "inputs": [
          {
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
          }
        ],
        "name": "withdraw",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      }
    ];

    // ------- GLOBALS -------
    let provider;
    let signer;
    let contract;
    let currentAddress;

    // ------- CONNECT WALLET -------
    async function connectWallet() {
      if (!window.ethereum) {
        alert("Please install MetaMask!");
        return;
      }

      try {
        await window.ethereum.request({ method: "eth_requestAccounts" });

        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        contract = new ethers.Contract(contractAddress, contractABI, signer);

        currentAddress = await signer.getAddress();
        document.getElementById("wallet").innerText = "Connected: " + currentAddress;

        const btn = document.getElementById("connectBtn");
        btn.innerText = "âœ… Connected";
        btn.disabled = true;

        // Load initial Sepolia ETH balance
        await updateWalletBalance();
      } catch (err) {
        console.error(err);
        alert("Connection failed: " + (err.message || err));
      }
    }

    // ------- SHOW WALLET SEPOLIA ETH BALANCE -------
    async function updateWalletBalance() {
      if (!provider || !currentAddress) return;

      try {
        const balanceWei = await provider.getBalance(currentAddress);
        const balanceEth = ethers.utils.formatEther(balanceWei);
        document.getElementById("ethBalance").innerText = balanceEth + " ETH";
      } catch (err) {
        console.error(err);
        document.getElementById("ethBalance").innerText = "Error loading balance";
      }
    }

    // ------- INCREASE (DEPOSIT) -------
    async function increase() {
      if (!contract) {
        alert("Connect MetaMask first.");
        return;
      }

      const amountEth = document.getElementById("amountInput").value;
      if (!amountEth || Number(amountEth) <= 0) {
        alert("Enter a valid amount in ETH.");
        return;
      }

      try {
        const tx = await contract.deposit({
          value: ethers.utils.parseEther(amountEth)
        });
        await tx.wait();
        alert("Deposited " + amountEth + " ETH");

        // Update wallet Sepolia ETH balance after transaction
        await updateWalletBalance();
      } catch (err) {
        console.error(err);
        alert("Deposit failed: " + (err.data?.message || err.message || err));
      }
    }

    // ------- DECREASE (WITHDRAW) -------
    async function decrease() {
      if (!contract) {
        alert("Connect MetaMask first.");
        return;
      }

      const amountEth = document.getElementById("amountInput").value;
      if (!amountEth || Number(amountEth) <= 0) {
        alert("Enter a valid amount in ETH.");
        return;
      }

      try {
        const amountWei = ethers.utils.parseEther(amountEth);
        const tx = await contract.withdraw(amountWei);
        await tx.wait();
        alert("Withdrawn " + amountEth + " ETH");

        // Update wallet Sepolia ETH balance after transaction
        await updateWalletBalance();
      } catch (err) {
        console.error(err);
        alert("Withdraw failed: " + (err.data?.message || err.message || err));
      }
    }
  </script>
</body>
</html>
